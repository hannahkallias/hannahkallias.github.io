<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persistent To-Do List with APIs</title>
    <style>
        .dark-mode {
            background-color: #333;
            color: white;
        }
        .light-mode {
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>
    <h2>To-Do List</h2>
    <form id="todo-form">
        <input type="text" id="task" placeholder="Enter a task" required>
        <button type="submit">Add Task</button>
    </form>
    <ul id="task-list"></ul>
    <h3>Tasks Added This Session: <span id="task-count">0</span></h3>
    <button id="theme-toggle">Toggle Dark Mode</button>

    <h3>Motivational Quote</h3>
    <p id="quote-text">Click the button to get a quote!</p>
    <button id="fetch-quote">Get New Quote</button>

    <script> 
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("todo-form");
            const taskInput = document.getElementById("task");
            const taskList = document.getElementById("task-list");
            const taskCountDisplay = document.getElementById("task-count");
            const themeToggle = document.getElementById("theme-toggle");
            const quoteText = document.getElementById("quote-text");
            const fetchQuoteButton = document.getElementById("fetch-quote");

            loadTasks();
            loadSessionCount();
            fetchQuote();

            form.addEventListener("submit", (event) => {
                event.preventDefault();
                const taskText = taskInput.value.trim();
                if (taskText) {
                    addTask(taskText);
                    incrementSessionCount();
                    taskInput.value = ""; 
                }
            });

            function addTask(taskText) {
                const tasks = getTasks();
                tasks.push(taskText);
                localStorage.setItem("tasks", JSON.stringify(tasks));
                renderTasks();
            }

            function loadTasks() {
                renderTasks();
            }

            function renderTasks() {
                taskList.innerHTML = ""; 
                const tasks = getTasks();
                tasks.forEach((task, index) => {
                    const li = document.createElement("li");
                    li.innerHTML = `${task} <button onclick="removeTask(${index})">X</button>`;
                    taskList.appendChild(li);
                });
            }

            window.removeTask = function(index) {
                let tasks = getTasks();
                tasks.splice(index, 1);
                localStorage.setItem("tasks", JSON.stringify(tasks));
                renderTasks();
            };

            function getTasks() {
                return JSON.parse(localStorage.getItem("tasks")) || [];
            }

            function loadSessionCount() {
                let count = sessionStorage.getItem("taskCount") || 0;
                taskCountDisplay.textContent = count;
            }

            function incrementSessionCount() {
                let count = sessionStorage.getItem("taskCount") || 0;
                count = parseInt(count) + 1;
                sessionStorage.setItem("taskCount", count);
                taskCountDisplay.textContent = count;
            }

            // Theme toggle
            function setTheme(theme) {
                document.body.classList.remove("light-mode", "dark-mode");
                document.body.classList.add(theme);
                document.cookie = `theme=${theme}; path=/; max-age=31536000`; // 1 year
            }

            function getThemeFromCookies() {
                const cookies = document.cookie.split("; ");
                for (let cookie of cookies) {
                    let [name, value] = cookie.split("=");
                    if (name === "theme") {
                        return value;
                    }
                }
                return "light-mode"; 
            }

            const savedTheme = getThemeFromCookies();
            setTheme(savedTheme);

            themeToggle.addEventListener("click", () => {
                const newTheme = document.body.classList.contains("dark-mode") ? "light-mode" : "dark-mode";
                setTheme(newTheme);
            });

            async function fetchQuote() {
                try {
                    const response = await fetch("https://api.quotable.io/random");
                    if (!response.ok) {
                        throw new Error("Failed to fetch quote.");
                    }
                    const data = await response.json();
                    quoteText.textContent = `"${data.content}" â€” ${data.author}`;
                } catch (error) {
                    quoteText.textContent = "Could not load a quote. Please try again!";
                }
            }

            fetchQuoteButton.addEventListener("click", fetchQuote);
        });
    </script>
</body>
</html>
